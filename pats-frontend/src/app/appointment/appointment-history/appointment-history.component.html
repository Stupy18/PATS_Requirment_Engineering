<div class="history-container">
  <h2>Appointment History & Upcoming Appointments</h2>

  <!-- Loading/Error Messages -->
  <div *ngIf="loading" class="alert alert-info">Loading appointment information...</div>
  <div *ngIf="errorMessage" class="alert alert-error">{{ errorMessage }}</div>

  <!-- Tabs -->
  <div class="tabs">
    <button [class.active]="activeTab === 'upcoming'" (click)="activeTab = 'upcoming'" class="tab-button">
      Upcoming Appointments
    </button>
    <button [class.active]="activeTab === 'history'" (click)="activeTab = 'history'" class="tab-button">
      Past Appointments & History
    </button>
  </div>

  <!-- Upcoming Appointments Tab -->
  <div *ngIf="activeTab === 'upcoming'" class="tab-content">
    <div *ngIf="getUpcomingAppointments().length === 0" class="no-data">
      No upcoming appointments scheduled
    </div>

    <div *ngIf="getUpcomingAppointments().length > 0" class="appointments-list">
      <div *ngFor="let appointment of getUpcomingAppointments()" class="appointment-card">
        <div class="appointment-header">
          <h3>Appointment</h3>
          <span [class]="'badge ' + getStatusClass(appointment.status)">{{ appointment.status }}</span>
        </div>

        <div class="appointment-details">
          <p>
            <strong>Date & Time:</strong>
            {{ appointment.appointmentDateTime | date: 'MMMM dd, yyyy - HH:mm' }}
          </p>
          <p>
            <strong>Type:</strong> {{ appointment.type }}
          </p>
          <p>
            <strong>Duration:</strong> {{ appointment.durationMinutes }} minutes
          </p>
          <p *ngIf="appointment.appointmentNotes">
            <strong>Notes:</strong> {{ appointment.appointmentNotes }}
          </p>
        </div>

        <div class="appointment-actions">
          <button class="btn btn-secondary btn-sm" [disabled]="true">
            Reschedule (24h notice required)
          </button>
          <button class="btn btn-danger btn-sm" [disabled]="true">
            Cancel
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Past Appointments & History Tab -->
  <div *ngIf="activeTab === 'history'" class="tab-content">
    <div *ngIf="getPastAppointments().length === 0 && appointmentHistories.length === 0" class="no-data">
      No appointment history available
    </div>

    <div *ngIf="getPastAppointments().length > 0" class="appointments-list">
      <h3>Past Appointments</h3>
      <div *ngFor="let appointment of getPastAppointments()" class="appointment-card history-card">
        <div class="appointment-header">
          <h4>Appointment - {{ appointment.appointmentDateTime | date: 'MMM dd, yyyy' }}</h4>
          <span [class]="'badge ' + getStatusClass(appointment.status)">{{ appointment.status }}</span>
        </div>

        <div class="appointment-details">
          <p>
            <strong>Date & Time:</strong>
            {{ appointment.appointmentDateTime | date: 'MMMM dd, yyyy - HH:mm' }}
          </p>
          <p *ngIf="appointment.type">
            <strong>Type:</strong> {{ appointment.type }}
          </p>
          <p>
            <strong>Duration:</strong> {{ appointment.durationMinutes }} minutes
          </p>
          <p *ngIf="appointment.appointmentNotes">
            <strong>Notes:</strong> {{ appointment.appointmentNotes }}
          </p>
        </div>
      </div>
    </div>

    <!-- Appointment History Records -->
    <div *ngIf="appointmentHistories.length > 0" class="history-records">
      <h3>Attendance & Appointment Records</h3>
      <div class="table-responsive">
        <table class="history-table">
          <thead>
            <tr>
              <th>Date</th>
              <th>Status</th>
              <th>Duration</th>
              <th>Notes</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let history of appointmentHistories">
              <td>{{ history.createdAt | date: 'MMM dd, yyyy' }}</td>
              <td>
                <span [class]="'badge ' + getAttendanceClass(history.attendanceStatus)">
                  {{ history.attendanceStatus }}
                </span>
              </td>
              <td>{{ history.actualDurationMinutes || 'N/A' }}</td>
              <td>{{ history.notes || '-' }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
