<div class="dashboard-container">
  <app-navbar></app-navbar>

  <div class="dashboard-layout">
    <div class="content-area">
      <!-- Page Header -->
      <header class="page-header">
        <div>
          <h1 class="page-title">Patient Management</h1>
          <p class="page-subtitle">View and manage your patient roster</p>
        </div>
        <button class="btn-primary" routerLink="/psychologist/patients/new">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="12" y1="5" x2="12" y2="19"/>
            <line x1="5" y1="12" x2="19" y2="12"/>
          </svg>
          Add New Patient
        </button>
      </header>

      <!-- Error Message -->
      <div *ngIf="errorMessage" class="alert alert-error">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"/>
          <line x1="12" y1="8" x2="12" y2="12"/>
          <line x1="12" y1="16" x2="12.01" y2="16"/>
        </svg>
        {{ errorMessage }}
      </div>

      <!-- Search and Filter Bar -->
      <div class="toolbar">
        <div class="search-container">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="search-icon">
            <circle cx="11" cy="11" r="8"/>
            <path d="m21 21-4.35-4.35"/>
          </svg>
          <input
            type="text"
            [(ngModel)]="searchTerm"
            (input)="onSearch()"
            placeholder="Search patients by name..."
            class="search-input"
          />
        </div>
        <button class="btn-secondary" (click)="loadPatients()" [disabled]="loading" title="Refresh list">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="23 4 23 10 17 10"/>
            <polyline points="1 20 1 14 7 14"/>
            <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/>
          </svg>
          Refresh
        </button>
      </div>

      <!-- Loading State -->
      <div *ngIf="loading" class="loading-state">
        <div class="spinner"></div>
        <p>Loading patients...</p>
      </div>

      <!-- Empty State -->
      <div *ngIf="!loading && filteredPatients.length === 0" class="empty-state">
        <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
          <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
          <circle cx="9" cy="7" r="4"/>
          <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
          <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
        </svg>
        <h3 *ngIf="searchTerm">No patients found</h3>
        <h3 *ngIf="!searchTerm">No patients yet</h3>
        <p *ngIf="searchTerm">Try adjusting your search terms</p>
        <p *ngIf="!searchTerm">Add your first patient to get started</p>
        <button class="btn-primary" routerLink="/psychologist/patients/new" *ngIf="!searchTerm">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="12" y1="5" x2="12" y2="19"/>
            <line x1="5" y1="12" x2="19" y2="12"/>
          </svg>
          Add First Patient
        </button>
      </div>

      <!-- Patient Cards Grid -->
      <div *ngIf="!loading && filteredPatients.length > 0" class="patient-grid">
        <div *ngFor="let patient of filteredPatients" class="patient-card">
          <div class="card-header">
            <div class="patient-avatar">
              {{ patient.firstName.charAt(0) }}{{ patient.lastName.charAt(0) }}
            </div>
            <div class="patient-identity">
              <h3 class="patient-name">{{ patient.firstName }} {{ patient.lastName }}</h3>
              <span class="patient-id">Patient ID: #{{ patient.id }}</span>
            </div>
          </div>

          <div class="card-body">
            <div class="info-grid">
              <div class="info-item" *ngIf="patient.dateOfBirth">
                <span class="info-label">Age</span>
                <span class="info-value">{{ getPatientAge(patient.dateOfBirth) }} years</span>
              </div>

              <div class="info-item" *ngIf="patient.gender">
                <span class="info-label">Gender</span>
                <span class="info-value">{{ patient.gender }}</span>
              </div>

              <div class="info-item" *ngIf="patient.phoneNumber">
                <span class="info-label">Phone</span>
                <span class="info-value">{{ patient.phoneNumber }}</span>
              </div>

              <div class="info-item" *ngIf="patient.city">
                <span class="info-label">Location</span>
                <span class="info-value">{{ patient.city }}</span>
              </div>
            </div>
          </div>

          <div class="card-footer">
            <button
              class="btn-action btn-primary-outline"
              (click)="createPatientRecord(patient.id!)"
              title="View or create electronic medical record"
            >
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                <polyline points="14 2 14 8 20 8"/>
              </svg>
              Medical Record
            </button>
            <button
              class="btn-action btn-secondary-outline"
              (click)="viewEmergencyContacts(patient.id!)"
              title="View emergency contacts"
            >
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/>
              </svg>
              Emergency Contacts
            </button>
          </div>
        </div>
      </div>

      <!-- Results Summary -->
      <div *ngIf="!loading && filteredPatients.length > 0" class="results-summary">
        <span class="summary-text">
          Showing <strong>{{ filteredPatients.length }}</strong> of <strong>{{ patients.length }}</strong> patients
        </span>
      </div>
    </div>
  </div>
</div>
